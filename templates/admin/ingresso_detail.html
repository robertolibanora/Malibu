{% extends "admin/base.html" %}
{% block admin_title %}Ingresso{% endblock %}

{% block admin_content %}
<div class="cliente-detail">
  <!-- Header con info principali -->
  <section class="card">
    <div class="cliente-header">
      <div class="cliente-header__main">
        <h1 class="card__title">Ingresso</h1>
        <div class="cliente-header__meta">
          <span class="badge badge--warning">{{ ingresso.tipo_ingresso|capitalize }}</span>
        </div>
      </div>
      <div class="cliente-header__actions">
        <a href="{{ url_for('ingressi.admin_list') }}" class="btn btn--secondary">← Torna alla lista</a>
      </div>
    </div>
  </section>

  <!-- Informazioni ingresso -->
  <div class="grid grid--2">
    <section class="card">
      <h2 class="card__title">Informazioni Ingresso</h2>
      <div class="info-list">
        <div class="info-item">
          <span class="info-label">Cliente:</span>
          <span class="info-value">
            <a href="{{ url_for('clienti.admin_cliente_detail', cliente_id=cliente.id_cliente) }}" class="text--gold">
              {{ cliente.nome }} {{ cliente.cognome }}
            </a>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Evento:</span>
          <span class="info-value">
            <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento.id_evento) }}" class="text--gold">
              {{ evento.nome_evento }}
            </a>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Data Evento:</span>
          <span class="info-value">{{ evento.data_evento }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Tipo Ingresso:</span>
          <span class="info-value">{{ ingresso.tipo_ingresso|capitalize }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Orario Ingresso:</span>
          <span class="info-value">{{ ingresso.orario_ingresso.strftime('%d/%m/%Y %H:%M:%S') if ingresso.orario_ingresso else '—' }}</span>
        </div>
        {% if staff %}
        <div class="info-item">
          <span class="info-label">Check-in effettuato da:</span>
          <span class="info-value">
            <strong class="text--gold">{{ staff.nome }}</strong>
            {% if staff.ruolo %}
              <span class="badge badge--secondary" style="margin-left: 0.5rem;">{{ staff.ruolo|capitalize }}</span>
            {% endif %}
          </span>
        </div>
        {% else %}
        <div class="info-item">
          <span class="info-label">Check-in effettuato da:</span>
          <span class="info-value text--muted">Non specificato</span>
        </div>
        {% endif %}
        {% if prenotazione %}
        <div class="info-item">
          <span class="info-label">Prenotazione Collegata:</span>
          <span class="info-value">
            <a href="{{ url_for('prenotazioni.admin_prenotazione_detail', pren_id=prenotazione.id_prenotazione) }}" class="text--gold">
              Visualizza prenotazione
            </a>
            <span class="badge badge--{{ 'success' if prenotazione.stato == 'usata' else 'secondary' }}" style="margin-left: 0.5rem;">
              {{ prenotazione.stato|capitalize }}
            </span>
          </span>
        </div>
        {% endif %}
        {% if ingresso.note %}
        <div class="info-item" style="flex-direction: column; align-items: flex-start;">
          <span class="info-label" style="margin-bottom: 0.5rem;">Note:</span>
          <span class="info-value">{{ ingresso.note }}</span>
        </div>
        {% endif %}
      </div>
    </section>

    <!-- Gestione ingresso -->
    <section class="card">
      <h2 class="card__title">Gestione Ingresso</h2>
      
      <div class="form__actions" style="margin-bottom: 1.5rem;">
        <a href="{{ url_for('ingressi.admin_edit', ingresso_id=ingresso.id_ingresso) }}" class="btn btn--primary">Modifica Ingresso</a>
      </div>

      <div class="form__actions" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(212, 175, 55, 0.1);">
        <form method="post" action="{{ url_for('ingressi.admin_delete', ingresso_id=ingresso.id_ingresso) }}" style="display:inline" onsubmit="return confirm('Annullare il check-in? Questa azione eliminerà l\'ingresso e, se collegato, ripristinerà la prenotazione a \"attiva\".');">
          <button class="btn btn--danger">Annulla Check-in</button>
        </form>
      </div>
    </section>
  </div>
</div>
{% endblock %}

