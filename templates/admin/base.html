{% extends "shared/base.html" %}
{% block title %}{% block admin_title %}Admin{% endblock %} Â· MalibÃ¹{% endblock %}

{% block body_class %}admin-section admin-minimal{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
  <script src="{{ url_for('static', filename='js/chart.umd.min.js') }}"></script>
{% endblock %}

{% block header_nav %}
  {% set endpoint = request.endpoint or '' %}
  {% set is_dashboard = endpoint in ('dashboard.admin_dashboard', 'dashboard.admin_statistics') %}
  {% set is_eventi = endpoint.startswith('eventi.admin_') %}
  {% set is_clienti = endpoint.startswith('clienti.admin_') or endpoint.startswith('fedelta.admin_') %}
  {% set is_operativo = endpoint.startswith('prenotazioni.admin_') or endpoint.startswith('ingressi.admin_') or endpoint.startswith('consumi.admin_') or endpoint.startswith('feedback.admin_') %}
  {% set is_stats = endpoint.startswith('stats.admin_') %}
  {% set is_config = endpoint.startswith('staff_admin.admin_') or endpoint.startswith('prodotti.admin_') or endpoint.startswith('log.') %}
  
  <div class="admin-shell">
    <!-- Sidebar Principale -->
    <aside class="admin-shell__sidebar" aria-label="Navigazione amministrazione">
      <div class="admin-shell__sidebar-header">
        <a href="{{ url_for('dashboard.admin_dashboard') }}" class="admin-shell__logo" aria-label="Home Admin">
          <img src="{{ url_for('static', filename='img/logo.png') }}" alt="MalibÃ¹">
          <span class="admin-shell__logo-text">MalibÃ¹ Admin</span>
        </a>
      </div>
      
      <nav class="admin-shell__nav" aria-label="Menu principale">
        <a href="{{ url_for('dashboard.admin_dashboard') }}" 
           class="admin-shell__nav-item {% if is_dashboard %}admin-shell__nav-item--active{% endif %}">
          <span class="admin-shell__nav-icon">ğŸ“Š</span>
          <span class="admin-shell__nav-label">Dashboard</span>
        </a>

        <a href="{{ url_for('eventi.admin_list') }}" 
           class="admin-shell__nav-item {% if is_eventi %}admin-shell__nav-item--active{% endif %}">
          <span class="admin-shell__nav-icon">ğŸ“…</span>
          <span class="admin-shell__nav-label">Eventi</span>
        </a>

        <a href="{{ url_for('clienti.admin_lista_clienti') }}" 
           class="admin-shell__nav-item {% if is_clienti %}admin-shell__nav-item--active{% endif %}">
          <span class="admin-shell__nav-icon">ğŸ‘¥</span>
          <span class="admin-shell__nav-label">Clienti</span>
        </a>

        <a href="{{ url_for('prenotazioni.admin_hub') }}" 
           class="admin-shell__nav-item {% if is_operativo %}admin-shell__nav-item--active{% endif %}"
           style="position: relative;">
          <span class="admin-shell__nav-icon">ğŸ“‹</span>
          <span class="admin-shell__nav-label">Operativo</span>
          {% if prenotazioni_tavolo_attesa_count and prenotazioni_tavolo_attesa_count > 0 %}
          <span class="admin-badge" style="position: absolute; top: 8px; right: 8px; background: #ef4444; color: white; border-radius: 10px; padding: 2px 6px; font-size: 10px; font-weight: 600; min-width: 18px; text-align: center; line-height: 1.4;">{{ prenotazioni_tavolo_attesa_count }}</span>
          {% endif %}
        </a>

        <a href="{{ url_for('stats.admin_hub') }}" 
           class="admin-shell__nav-item {% if is_stats %}admin-shell__nav-item--active{% endif %}">
          <span class="admin-shell__nav-icon">ğŸ“ˆ</span>
          <span class="admin-shell__nav-label">Statistiche</span>
        </a>

        <a href="{{ url_for('staff_admin.admin_hub') }}" 
           class="admin-shell__nav-item {% if is_config %}admin-shell__nav-item--active{% endif %}">
          <span class="admin-shell__nav-icon">âš™ï¸</span>
          <span class="admin-shell__nav-label">Configurazione</span>
        </a>
      </nav>

      <div class="admin-shell__sidebar-footer">
        <a href="{{ url_for('auth.logout') }}" class="admin-shell__logout">
          <span class="admin-shell__logout-icon">ğŸšª</span>
          <span>Logout</span>
        </a>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="admin-shell__main">
      {% block admin_content %}{% endblock %}
    </main>
  </div>
{% endblock %}

{% block content %}
  {# Il contenuto Ã¨ gestito direttamente in header_nav #}
{% endblock %}
