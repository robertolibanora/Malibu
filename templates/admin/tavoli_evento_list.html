{% extends "admin/base.html" %}
{% block admin_title %}Tavoli Evento{% endblock %}

{% from "admin/_page_header.html" import render_page_header %}

{% block admin_content %}
<div class="admin-shell__content">
  {{ render_page_header(
    title="Gestione Tavoli",
    subtitle="Tavoli configurati per: " ~ evento.nome_evento ~ " (" ~ (evento.data_evento.strftime('%d/%m/%Y') if evento.data_evento else 'N/A') ~ ")",
    actions=[
      {'type': 'link', 'url': url_for('prenotazioni.admin_tavolo_new', evento_id=evento.id_evento), 'label': '+ Nuovo Tavolo', 'class': 'btn--primary'},
      {'type': 'link', 'url': url_for('eventi.admin_evento_detail', evento_id=evento.id_evento), 'label': 'â† Evento', 'class': 'btn--ghost'}
    ],
    breadcrumbs=[
      {'label': 'Eventi', 'url': url_for('eventi.admin_list')},
      {'label': evento.nome_evento, 'url': url_for('eventi.admin_evento_detail', evento_id=evento.id_evento)},
      {'label': 'Tavoli'}
    ]
  ) }}

  <!-- Creazione Bulk Tavoli -->
  <section class="card" style="margin-bottom: var(--spacing-4); background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(212, 175, 55, 0.03) 100%); border: 1px solid rgba(212, 175, 55, 0.2);">
    <div class="card__header">
      <h2 class="card__title" style="margin: 0;">âš¡ Creazione Rapida Tavoli</h2>
    </div>
    <div class="card__content">
      <p class="text--muted" style="margin-bottom: var(--spacing-3);">
        Crea automaticamente i tavoli da 1 a 20 (o un numero personalizzato) per questo evento. 
        I tavoli giÃ  esistenti verranno saltati.
      </p>
      <form method="post" action="{{ url_for('prenotazioni.admin_tavoli_bulk_create', evento_id=evento.id_evento) }}" 
            onsubmit="return confirm('Vuoi creare i tavoli? I tavoli giÃ  esistenti verranno saltati.');">
        <div class="grid grid--2" style="gap: var(--spacing-3); margin-bottom: var(--spacing-3);">
          <div class="form__group" style="margin-bottom: 0;">
            <label class="form__label">Numero Tavoli</label>
            <input class="form__input" type="number" name="num_tavoli" value="20" min="1" max="100" required>
            <small class="form__hint">Tavoli da creare (da 1 a N)</small>
          </div>
          <div class="form__group" style="margin-bottom: 0;">
            <label class="form__label">Capienza Default</label>
            <input class="form__input" type="number" name="capienza" value="4" min="1" max="20" required>
            <small class="form__hint">Capienza per ogni tavolo</small>
          </div>
        </div>
        <div class="form__actions" style="border-top: none; padding-top: 0; margin-top: 0;">
          <button class="btn btn--primary" type="submit">
            âš¡ Crea Tavoli da 1 a <span id="num-tavoli-display">20</span>
          </button>
        </div>
      </form>
    </div>
  </section>

  <script>
    // Aggiorna il numero nel bottone quando cambia l'input
    document.addEventListener('DOMContentLoaded', function() {
      const numTavoliInput = document.querySelector('input[name="num_tavoli"]');
      const numTavoliDisplay = document.getElementById('num-tavoli-display');
      
      if (numTavoliInput && numTavoliDisplay) {
        numTavoliInput.addEventListener('input', function() {
          numTavoliDisplay.textContent = this.value || '20';
        });
      }
    });
  </script>

  {% if tavoli %}
  <div class="card">
    <table class="admin-table">
      <thead>
        <tr>
          <th class="admin-table__header">Numero</th>
          <th class="admin-table__header">Nome</th>
          <th class="admin-table__header">Capienza</th>
          <th class="admin-table__header">Prezzo Minimo</th>
          <th class="admin-table__header">Stato</th>
          <th class="admin-table__header admin-table__header--actions">Azioni</th>
        </tr>
      </thead>
      <tbody>
        {% for tavolo in tavoli %}
        <tr class="admin-table__row">
          <td class="admin-table__cell"><strong>{{ tavolo.numero_tavolo }}</strong></td>
          <td class="admin-table__cell">{{ tavolo.nome_tavolo or '-' }}</td>
          <td class="admin-table__cell">{{ tavolo.capienza }} persone</td>
          <td class="admin-table__cell">
            {% if tavolo.prezzo_minimo %}â‚¬{{ tavolo.prezzo_minimo }}{% else %}-{% endif %}
          </td>
          <td class="admin-table__cell">
            {% if tavolo.attivo %}
              <span class="badge badge--success">Attivo</span>
            {% else %}
              <span class="badge badge--secondary">Disattivo</span>
            {% endif %}
          </td>
          <td class="admin-table__cell admin-table__cell--actions">
            <a href="{{ url_for('prenotazioni.admin_tavolo_edit', tavolo_id=tavolo.id_tavolo) }}" 
               class="admin-table__action admin-table__action--edit" title="Modifica">âœï¸</a>
            <form method="post" action="{{ url_for('prenotazioni.admin_tavolo_delete', tavolo_id=tavolo.id_tavolo) }}" 
                  style="display: inline;" 
                  onsubmit="return confirm('Sei sicuro di voler eliminare questo tavolo?');">
              <button type="submit" class="admin-table__action admin-table__action--delete" title="Elimina">ğŸ—‘ï¸</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="card">
    <div class="admin-empty-state">
      <span class="admin-empty-state__icon">ğŸª‘</span>
      <p class="admin-empty-state__message">Nessun tavolo configurato per questo evento.</p>
      <a href="{{ url_for('prenotazioni.admin_tavolo_new', evento_id=evento.id_evento) }}" class="btn btn--primary">
        + Crea Primo Tavolo
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

