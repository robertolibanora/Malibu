{% extends "admin/base.html" %}
{% block admin_title %}Gestione Eventi{% endblock %}

{% block admin_content %}
<div class="events-hub">
  <header class="events-hub__header fade-in">
    <div class="events-hub__intro">
      <h1 class="events-hub__title">Control Center Eventi</h1>
      <p class="events-hub__subtitle">Crea, monitora e ottimizza il calendario eventi in un unico pannello</p>
    </div>
    <a href="{{ url_for('eventi.admin_new') }}" class="btn btn--primary btn--large">+ Nuovo Evento</a>
  </header>

  <section class="events-hub__status fade-in" style="animation-delay: 80ms;">
    {% if evento_attivo %}
    <article class="events-hub__banner events-hub__banner--active">
      <div>
        <span class="events-hub__banner-label">Evento operativo staff</span>
        <h2 class="events-hub__banner-title">{{ evento_attivo.nome_evento }}</h2>
        <p class="events-hub__banner-meta">
          {{ evento_attivo.data_evento.strftime('%d/%m/%Y') if evento_attivo.data_evento else 'Data da definire' }}
          {% if evento_attivo.categoria %} â€¢ {{ evento_attivo.categoria|capitalize }}{% endif %}
        </p>
      </div>
      <div class="events-hub__banner-actions">
        <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="btn btn--secondary btn--small">Gestisci evento</a>
        <form method="post" action="{{ url_for('eventi.admin_evento_attivo') }}">
          <button class="btn btn--ghost btn--small" type="submit" name="evento_id" value="clear">Chiudi evento</button>
        </form>
      </div>
    </article>
    {% else %}
    <article class="events-hub__banner events-hub__banner--warning">
      <div>
        <span class="events-hub__banner-label">Nessun evento operativo</span>
        <p class="events-hub__banner-meta">Imposta lâ€™evento attivo per lo staff per abilitare check-in e consumazioni.</p>
    </div>
      <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="btn btn--secondary btn--small">Imposta evento attivo</a>
    </article>
    {% endif %}
  </section>

  <section class="events-hub__stats fade-in" style="animation-delay: 120ms;">
    <article class="profile-metric">
      <span class="profile-metric__label">Eventi totali</span>
      <span class="profile-metric__value">{{ tot_eventi }}</span>
    </article>
    <article class="profile-metric">
      <span class="profile-metric__label">Eventi attivi</span>
      <span class="profile-metric__value">{{ eventi_attivi }}</span>
    </article>
    <article class="profile-metric">
      <span class="profile-metric__label">Programmatti</span>
      <span class="profile-metric__value">{{ eventi_programmati }}</span>
      <span class="profile-metric__meta">>= {{ oggi.strftime('%d/%m/%Y') }}</span>
    </article>
    <article class="profile-metric">
      <span class="profile-metric__label">Eventi passati</span>
      <span class="profile-metric__value">{{ eventi_passati }}</span>
    </article>
  </section>

  <section class="events-hub__grid fade-in" style="animation-delay: 160ms;">
    <article class="events-card">
      <h2 class="events-card__title">Creazione & Catalogo</h2>
      <div class="events-card__links">
        <a href="{{ url_for('eventi.admin_new') }}" class="action-link action-link--primary">
          <span class="action-link__icon">ï¼‹</span>
          <div>
            <span class="action-link__title">Crea nuovo evento</span>
            <span class="action-link__meta">Template precompilati e wizard guidato</span>
          </div>
        </a>
        <a href="{{ url_for('eventi.admin_list') }}" class="action-link">
          <span class="action-link__icon">ğŸ“‹</span>
          <div>
            <span class="action-link__title">Lista completa</span>
            <span class="action-link__meta">Filtri per stato, categoria e data</span>
          </div>
        </a>
        <a href="{{ url_for('eventi.admin_list', periodo='programmati') }}" class="action-link">
          <span class="action-link__icon">ğŸ“…</span>
          <div>
            <span class="action-link__title">Programmatti</span>
            <span class="action-link__meta">Eventi futuri in preparazione</span>
          </div>
        </a>
        <a href="{{ url_for('eventi.admin_list', periodo='passati') }}" class="action-link">
          <span class="action-link__icon">ğŸ—‚ï¸</span>
          <div>
            <span class="action-link__title">Storico eventi</span>
            <span class="action-link__meta">Archivio consultabile</span>
          </div>
        </a>
        <a href="{{ url_for('format.admin_list') }}" class="action-link">
          <span class="action-link__icon">ğŸ›ï¸</span>
          <div>
            <span class="action-link__title">Usa format predefiniti</span>
            <span class="action-link__meta">Duplica i template esistenti quando crei un evento</span>
          </div>
        </a>
      </div>
    </article>

    <article class="events-card">
      <h2 class="events-card__title">OperativitÃ  & Insights</h2>
      <div class="events-card__links">
        <a href="{{ url_for('eventi.admin_list', stato='attivo') }}" class="action-link">
          <span class="action-link__icon">âœ…</span>
          <div>
            <span class="action-link__title">Eventi attivi</span>
            <span class="action-link__meta">Quelli in corso o imminenti</span>
          </div>
        </a>
        <a href="{{ url_for('eventi.admin_list', stato='chiuso') }}" class="action-link">
          <span class="action-link__icon">ğŸ”’</span>
          <div>
            <span class="action-link__title">Eventi chiusi</span>
            <span class="action-link__meta">Conclusi e archiviati</span>
          </div>
        </a>
        <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="action-link">
          <span class="action-link__icon">ğŸ¯</span>
          <div>
            <span class="action-link__title">Evento operativo staff</span>
            <span class="action-link__meta">Punto di accesso rapido per lo staff</span>
          </div>
        </a>
        <a href="{{ url_for('dashboard.admin_statistics') }}" class="action-link">
          <span class="action-link__icon">ğŸ“ˆ</span>
          <div>
            <span class="action-link__title">Analytics eventi</span>
            <span class="action-link__meta">Ingressi, consumi e feedback globali</span>
          </div>
        </a>
        <div class="events-card__callout">
          <span class="events-card__callout-title">ğŸ’¡ Suggerimento</span>
          <p class="events-card__callout-text">
            Mantieni coerenti nomi e format: semplifica lâ€™analisi comparativa e la comunicazione con il team.
          </p>
        </div>
      </div>
    </article>
  </section>

  {% if prossimi_eventi %}
  <section class="events-hub__timeline fade-in" style="animation-delay: 200ms;">
    <div class="profile-card__header">
      <h2 class="profile-card__title">Eventi in arrivo</h2>
      <a href="{{ url_for('eventi.admin_list', periodo='programmati') }}" class="btn btn--ghost btn--small">Calendario completo â†’</a>
    </div>
    <ul class="timeline-list">
      {% for evento in prossimi_eventi %}
      <li class="timeline-item">
        <div class="timeline-item__header">
          <strong>{{ evento.nome_evento }}</strong>
          <div class="timeline-item__badges">
            <span class="badge badge--{{ 'success' if evento.stato == 'attivo' else 'secondary' }}">{{ evento.stato }}</span>
              <span class="badge badge--warning">{{ evento.categoria|capitalize }}</span>
          </div>
        </div>
        <div class="timeline-item__meta">
          {{ evento.data_evento.strftime('%d/%m/%Y') if evento.data_evento else 'Data da definire' }}
          {% if evento.dj_artista %} â€¢ {{ evento.dj_artista }}{% endif %}
        </div>
        <div class="timeline-item__actions">
          <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento.id_evento) }}" class="btn btn--primary btn--small">Dettaglio</a>
          <a href="{{ url_for('eventi.admin_analytics', evento_id=evento.id_evento) }}" class="btn btn--ghost btn--small">Analytics</a>
        </div>
      </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {% if ultimi_eventi %}
  <section class="events-hub__timeline fade-in" style="animation-delay: 240ms;">
    <div class="profile-card__header">
      <h2 class="profile-card__title">Eventi recenti</h2>
      <a href="{{ url_for('eventi.admin_list') }}" class="btn btn--ghost btn--small">Vedi elenco completo â†’</a>
    </div>
    <ul class="timeline-list">
      {% for evento in ultimi_eventi %}
      <li class="timeline-item">
        <div class="timeline-item__header">
          <strong>{{ evento.nome_evento }}</strong>
          <div class="timeline-item__badges">
            <span class="badge badge--{{ 'success' if evento.stato == 'attivo' else 'secondary' }}">{{ evento.stato }}</span>
              <span class="badge badge--warning">{{ evento.categoria|capitalize }}</span>
          </div>
        </div>
        <div class="timeline-item__meta">
          {{ evento.data_evento.strftime('%d/%m/%Y') if evento.data_evento else 'Data da definire' }}
          {% if evento.dj_artista %} â€¢ {{ evento.dj_artista }}{% endif %}
        </div>
        <div class="timeline-item__actions">
          <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento.id_evento) }}" class="btn btn--primary btn--small">Dettaglio</a>
          <a href="{{ url_for('eventi.admin_analytics', evento_id=evento.id_evento) }}" class="btn btn--ghost btn--small">Analytics</a>
        </div>
      </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}
</div>
{% endblock %}

