{% extends "admin/base.html" %}
{% block admin_title %}Menu Eventi{% endblock %}

{% block admin_content %}

<!-- Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
  <div>
    <h1 class="card__title" style="margin: 0;">Menu Gestione Eventi</h1>
    <p class="text--muted" style="margin-top: 0.5rem;">Pannello di controllo centralizzato per tutti gli eventi</p>
  </div>
  <a href="{{ url_for('eventi.admin_new') }}" class="btn btn--primary">+ Nuovo Evento</a>
</div>

<!-- Banner Evento Operativo Staff -->
{% if evento_attivo %}
<section class="card" style="margin-bottom: 2rem; border-left: 4px solid #10b981; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <div>
      <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
        <span style="font-size: 1.5rem;">ğŸŸ¢</span>
        <span style="font-weight: 600; color: #10b981;">EVENTO OPERATIVO STAFF</span>
        <span class="badge" style="background: #10b981; color: white; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 4px;">UN SOLO EVENTO ALLA VOLTA</span>
      </div>
      <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0 0 0.5rem;">{{ evento_attivo.nome_evento }}</h2>
      <p class="text--muted" style="margin: 0 0 0.5rem;">
        ğŸ“… {{ evento_attivo.data_evento.strftime('%d/%m/%Y') if evento_attivo.data_evento else 'Data da definire' }}
        {% if evento_attivo.categoria %} â€¢ {{ evento_attivo.categoria|capitalize }}{% endif %}
      </p>
      <p style="margin: 0; font-size: 0.85rem; color: #10b981; font-weight: 500;">
        âœ“ Questo Ã¨ l'evento su cui lo staff sta lavorando (check-in, consumi, ingressi)
      </p>
    </div>
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
      <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento_attivo.id_evento) }}" class="btn btn--primary">
        ğŸ“Š Dashboard Evento
      </a>
      <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="btn btn--ghost">
        âš™ï¸ Cambia Evento
      </a>
    </div>
  </div>
</section>
{% else %}
<section class="card" style="margin-bottom: 2rem; border-left: 4px solid #f59e0b; background: rgba(245, 158, 11, 0.1);">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <div>
      <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
        <span style="font-size: 1.5rem;">âš ï¸</span>
        <span style="font-weight: 600; color: #f59e0b;">NESSUN EVENTO OPERATIVO</span>
      </div>
      <p class="text--muted" style="margin: 0 0 0.5rem;">Imposta un evento operativo per abilitare check-in e consumazioni dello staff.</p>
      <p style="margin: 0; font-size: 0.85rem; color: #f59e0b; font-weight: 500;">
        âš ï¸ Solo un evento alla volta puÃ² essere operativo per lo staff
      </p>
    </div>
    <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="btn btn--secondary">
      ğŸ¯ Imposta Evento Operativo
    </a>
  </div>
</section>
{% endif %}

<!-- Statistiche Rapide -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
  <div class="card" style="padding: 1.25rem; text-align: center; border-left: 4px solid var(--gold-primary);">
    <div style="font-size: 2.5rem; font-weight: 700; color: var(--gold-primary);">{{ tot_eventi }}</div>
    <div class="text--muted" style="margin-top: 0.5rem; font-size: 0.9rem;">Totale Eventi</div>
  </div>
  <div class="card" style="padding: 1.25rem; text-align: center; border-left: 4px solid #3b82f6;">
    <div style="font-size: 2.5rem; font-weight: 700; color: #3b82f6;">{{ eventi_programmati }}</div>
    <div class="text--muted" style="margin-top: 0.5rem; font-size: 0.9rem;">Programmati</div>
    <div class="text--muted" style="margin-top: 0.25rem; font-size: 0.75rem;">(non ancora pubblici)</div>
  </div>
  <div class="card" style="padding: 1.25rem; text-align: center; border-left: 4px solid #10b981;">
    <div style="font-size: 2.5rem; font-weight: 700; color: #10b981;">{{ eventi_attivi }}</div>
    <div class="text--muted" style="margin-top: 0.5rem; font-size: 0.9rem;">Attivi (Pubblico)</div>
    <div class="text--muted" style="margin-top: 0.25rem; font-size: 0.75rem;">(prenotabili dai clienti)</div>
  </div>
  <div class="card" style="padding: 1.25rem; text-align: center; border-left: 4px solid #6b7280;">
    <div style="font-size: 2.5rem; font-weight: 700; color: #6b7280;">{{ eventi_passati }}</div>
    <div class="text--muted" style="margin-top: 0.5rem; font-size: 0.9rem;">Passati</div>
  </div>
</div>

<!-- Azioni Principali -->
<section class="card" style="margin-bottom: 2rem;">
  <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">âš¡ Azioni Rapide</h2>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
    <a href="{{ url_for('eventi.admin_new') }}" class="card" style="padding: 1.5rem; text-decoration: none; border: 2px solid var(--gold-primary); background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%); transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">â•</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Crea Nuovo Evento</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Aggiungi un nuovo evento al calendario</p>
    </a>
    
    <a href="{{ url_for('eventi.admin_list') }}" class="card" style="padding: 1.5rem; text-decoration: none; transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">ğŸ“‹</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Lista Completa Eventi</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Visualizza e gestisci tutti gli eventi</p>
    </a>
    
    <a href="{{ url_for('eventi.admin_list', periodo='programmati') }}" class="card" style="padding: 1.5rem; text-decoration: none; transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">ğŸ“…</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Eventi Programmati</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Eventi futuri in preparazione</p>
    </a>
    
    <a href="{{ url_for('eventi.admin_evento_attivo') }}" class="card" style="padding: 1.5rem; text-decoration: none; transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">ğŸ¯</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Gestisci Evento Operativo</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Imposta l'evento attivo per lo staff</p>
    </a>
    
    <a href="{{ url_for('eventi.admin_list', stato='attivo') }}" class="card" style="padding: 1.5rem; text-decoration: none; transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">âœ…</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Eventi Attivi</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Eventi visibili al pubblico</p>
    </a>
    
    <a href="{{ url_for('dashboard.admin_statistics') }}" class="card" style="padding: 1.5rem; text-decoration: none; transition: transform 0.2s;">
      <div style="font-size: 2rem; margin-bottom: 0.75rem;">ğŸ“ˆ</div>
      <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">Analytics & Statistiche</h3>
      <p class="text--muted" style="margin: 0; font-size: 0.9rem;">Analisi ingressi, consumi e feedback</p>
    </a>
  </div>
</section>

<!-- Prossimi Eventi -->
{% if prossimi_eventi %}
<section class="card" style="margin-bottom: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">ğŸ“… Prossimi Eventi</h2>
    <a href="{{ url_for('eventi.admin_list', periodo='programmati') }}" class="btn btn--ghost btn--small">Vedi tutti â†’</a>
  </div>
  <div style="display: flex; flex-direction: column; gap: 1rem;">
    {% for evento in prossimi_eventi %}
    <article class="card" style="padding: 1.25rem; border-left: 4px solid {% if evento.stato_pubblico == 'attivo' %}#10b981{% elif evento.stato_pubblico == 'programmato' %}#3b82f6{% else %}#6b7280{% endif %};">
      <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 200px;">
          <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-primary);">
            {{ evento.nome_evento }}
          </h3>
          <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem;">
            <span class="badge" style="background: {% if evento.stato_pubblico == 'attivo' %}#10b981{% elif evento.stato_pubblico == 'programmato' %}#3b82f6{% else %}#6b7280{% endif %}; color: white; font-weight: 500;">
              {% if evento.stato_pubblico == 'attivo' %}âœ… ATTIVO{% elif evento.stato_pubblico == 'programmato' %}ğŸ“‹ PROGRAMMATO{% else %}ğŸ”’ CHIUSO{% endif %}
            </span>
            <span class="badge badge--secondary">{{ evento.categoria|capitalize }}</span>
          </div>
          <p class="text--muted" style="margin: 0; font-size: 0.9rem;">
            ğŸ“… {{ evento.data_evento.strftime('%d/%m/%Y') if evento.data_evento else 'Data da definire' }}
            {% if evento.dj_artista %} â€¢ ğŸ§ {{ evento.dj_artista }}{% endif %}
          </p>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
          <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento.id_evento) }}" class="btn btn--primary btn--small">
            ğŸ“Š Dashboard
          </a>
          <a href="{{ url_for('eventi.admin_edit', evento_id=evento.id_evento) }}" class="btn btn--ghost btn--small">
            âœï¸ Modifica
          </a>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- Eventi Recenti -->
{% if ultimi_eventi %}
<section class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">ğŸ“š Eventi Recenti</h2>
    <a href="{{ url_for('eventi.admin_list', periodo='passati') }}" class="btn btn--ghost btn--small">Vedi tutti â†’</a>
  </div>
  <div style="display: flex; flex-direction: column; gap: 1rem;">
    {% for evento in ultimi_eventi %}
    <article class="card" style="padding: 1.25rem; border-left: 4px solid #6b7280; opacity: 0.85;">
      <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 200px;">
          <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem; color: var(--text-secondary);">
            {{ evento.nome_evento }}
          </h3>
          <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem;">
            <span class="badge badge--secondary">ğŸ”’ CHIUSO</span>
            <span class="badge badge--secondary">{{ evento.categoria|capitalize }}</span>
          </div>
          <p class="text--muted" style="margin: 0; font-size: 0.9rem;">
            ğŸ“… {{ evento.data_evento.strftime('%d/%m/%Y') if evento.data_evento else 'Data da definire' }}
            {% if evento.dj_artista %} â€¢ ğŸ§ {{ evento.dj_artista }}{% endif %}
          </p>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
          <a href="{{ url_for('eventi.admin_evento_detail', evento_id=evento.id_evento) }}" class="btn btn--ghost btn--small">
            ğŸ“Š Dettagli
          </a>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% endblock %}
