{% extends "admin/base.html" %}
{% block admin_title %}Analytics FedeltÃ {% endblock %}
{% block admin_content %}
<!-- Navigazione Secondaria Clienti -->
<div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.08);">
  <a href="{{ url_for('clienti.admin_lista_clienti') }}" class="btn btn--ghost btn--small">ğŸ‘¥ Anagrafica</a>
  <a href="{{ url_for('fedelta.admin_list') }}" class="btn btn--ghost btn--small">â­ Punti FedeltÃ </a>
  <a href="{{ url_for('fedelta.admin_movimenti') }}" class="btn btn--ghost btn--small">ğŸ“Š Movimenti</a>
  <a href="{{ url_for('fedelta.admin_analytics') }}" class="btn btn--primary btn--small">ğŸ“ˆ Analytics</a>
  <a href="{{ url_for('feedback.admin_list') }}" class="btn btn--ghost btn--small">ğŸ’¬ Feedback</a>
</div>

<section class="card">
  <h1 class="card__title">Analytics FedeltÃ </h1>
  <form class="form" method="get">
    <div class="grid grid--2">
      <div class="form__group">
        <label class="form__label">Dal</label>
        <input class="form__input" type="date" name="dal" value="{{ dal or '' }}">
      </div>
      <div class="form__group">
        <label class="form__label">Al</label>
        <input class="form__input" type="date" name="al" value="{{ al or '' }}">
      </div>
    </div>
    <div class="form__actions">
      <button class="btn btn--primary">Applica</button>
    </div>
  </form>
</section>

<section class="card">
  <h2 class="card__title">Top clienti</h2>
  <ul class="list">
    {% for c, pts in top %}
    <li class="list__item">{{ c.cognome }} {{ c.nome }} â€” <strong>{{ pts }} pt</strong></li>
    {% endfor %}
  </ul>
</section>

<section class="card">
  <h2 class="card__title">Distribuzione livelli</h2>
  <ul class="list">
    {% for lvl, count in dist.items() %}
    <li class="list__item">{{ lvl|upper }} â€” <strong>{{ count }}</strong></li>
    {% endfor %}
  </ul>
</section>

<section class="card">
  <h2 class="card__title">Punti medi per evento</h2>
  <ul class="list">
    {% for ev_id, avgp in per_evento.items() %}
    <li class="list__item">Evento â€” <strong>{{ '%.2f'|format(avgp) }}</strong> pt</li>
    {% endfor %}
  </ul>
</section>
{% endblock %}