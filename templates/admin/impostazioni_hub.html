{% extends "admin/base.html" %}
{% block admin_title %}Impostazioni{% endblock %}

{% from "admin/_page_header.html" import render_page_header %}
{% from "admin/_secondary_nav.html" import render_secondary_nav %}

{% block admin_content %}
<div class="admin-shell__content">
  {{ render_secondary_nav([
    {'url': url_for('staff_admin.admin_hub'), 'endpoint': 'staff_admin.admin_hub', 'label': 'Hub Impostazioni', 'icon': None},
    {'url': url_for('staff_admin.admin_list'), 'endpoint': 'staff_admin.admin_list', 'label': 'Staff', 'icon': None},
    {'url': url_for('prodotti.admin_list'), 'endpoint': 'prodotti.admin_list', 'label': 'Prodotti', 'icon': None},
    {'url': url_for('fedelta.admin_soglie'), 'endpoint': 'fedelta.admin_soglie', 'label': 'Soglie', 'icon': None},
    {'url': url_for('log.list'), 'endpoint': 'log.list', 'label': 'Log', 'icon': None},
  ], current_endpoint=request.endpoint) }}
  
  {{ render_page_header(
    title="Impostazioni Sistema",
    subtitle="Gestione staff, listino prodotti e configurazioni sistema",
    actions=None,
    breadcrumbs=[
      {'label': 'Configurazione', 'url': url_for('staff_admin.admin_hub')}
    ]
  ) }}

  <!-- Statistiche Rapide -->
  <div class="grid grid--auto">
    <div class="stat-card" style="border-left: 4px solid var(--admin-accent); text-align: center;">
      <div class="stat-card__value" style="color: var(--admin-accent);">{{ tot_staff }}</div>
      <div class="stat-card__label">Staff Totale</div>
      <div class="stat-card__meta">({{ staff_attivi }} attivi)</div>
    </div>
    <div class="stat-card" style="border-left: 4px solid var(--admin-accent); text-align: center;">
      <div class="stat-card__value" style="color: var(--admin-accent);">{{ tot_prodotti }}</div>
      <div class="stat-card__label">Prodotti Listino</div>
      <div class="stat-card__meta">({{ prodotti_attivi }} attivi)</div>
    </div>
    <div class="stat-card" style="border-left: 4px solid var(--admin-accent); text-align: center;">
      <div class="stat-card__value" style="color: var(--admin-accent);">{{ soglie|length }}</div>
      <div class="stat-card__label">Livelli Fedeltà</div>
    </div>
  </div>

  <!-- Sezioni Impostazioni -->
  <div class="grid grid--auto">
    <!-- Staff -->
    <section class="card">
      <div class="card__header">
        <div style="display: flex; align-items: center; gap: var(--spacing-3);">
          <div>
            <h2 class="card__title" style="margin: 0;">Gestione Staff</h2>
            <p class="card__meta" style="margin: 0;">Utenti, ruoli e permessi</p>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
          <a href="{{ url_for('staff_admin.admin_list') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Lista Staff
          </a>
          <a href="{{ url_for('staff_admin.admin_new') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Nuovo Staff
          </a>
        </div>
      </div>
      <div class="card__footer">
        <p class="text--muted" style="margin: 0; font-size: var(--font-size-xs);">
          <strong>{{ staff_attivi }}</strong> membri attivi su <strong>{{ tot_staff }}</strong> totali
        </p>
      </div>
    </section>

    <!-- Listino Prodotti -->
    <section class="card">
      <div class="card__header">
        <div style="display: flex; align-items: center; gap: var(--spacing-3);">
          <div>
            <h2 class="card__title" style="margin: 0;">Listino Prodotti</h2>
            <p class="card__meta" style="margin: 0;">Bevande, snack e prezzi</p>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
          <a href="{{ url_for('prodotti.admin_list') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Lista Prodotti
          </a>
          <a href="{{ url_for('prodotti.admin_new') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Nuovo Prodotto
          </a>
        </div>
      </div>
      <div class="card__footer">
        <p class="text--muted" style="margin: 0; font-size: var(--font-size-xs);">
          <strong>{{ prodotti_attivi }}</strong> prodotti attivi su <strong>{{ tot_prodotti }}</strong> totali
        </p>
      </div>
    </section>

    <!-- Fedeltà e Soglie -->
    <section class="card">
      <div class="card__header">
        <div style="display: flex; align-items: center; gap: var(--spacing-3);">
          <div>
            <h2 class="card__title" style="margin: 0;">Sistema Fedeltà</h2>
            <p class="card__meta" style="margin: 0;">Soglie, livelli e punti</p>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
          <a href="{{ url_for('fedelta.admin_soglie') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Configura Soglie
          </a>
        </div>
      </div>
      {% if soglie %}
      <div class="card__footer">
        <p class="text--muted" style="margin: 0 0 var(--spacing-2); font-size: var(--font-size-xs);">Livelli attuali:</p>
        <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-2);">
          {% for s in soglie %}
          <span class="badge badge--secondary" style="font-size: var(--font-size-xs);">
            {{ s.nome|capitalize }}: {{ s.punti_min }}pt
          </span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </section>

    <!-- Log Attività -->
    <section class="card">
      <div class="card__header">
        <div style="display: flex; align-items: center; gap: var(--spacing-3);">
          <div>
            <h2 class="card__title" style="margin: 0;">Log Attività</h2>
            <p class="card__meta" style="margin: 0;">Tracciamento operazioni sistema</p>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
          <a href="{{ url_for('log.list') }}" class="btn btn--ghost" style="width: 100%; justify-content: flex-start;">
            Visualizza Log
          </a>
        </div>
      </div>
      <div class="card__footer">
        <p class="text--muted" style="margin: 0; font-size: var(--font-size-xs);">
          Registro completo di tutte le operazioni eseguite nel sistema
        </p>
      </div>
    </section>
  </div>
</div>
{% endblock %}
