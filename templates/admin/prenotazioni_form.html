{% extends "admin/base.html" %}
{% block admin_title %}{{ 'Modifica' if e else 'Nuova' }} Prenotazione{% endblock %}

{% block content %}
<section class="card">
  <h1 class="card__title">{{ 'Modifica' if e else 'Nuova' }} prenotazione</h1>
  <form class="form" method="post">
    <div class="grid grid--2">
      <div class="form__group">
        <label class="form__label">Cliente</label>
        <select class="form__input" name="cliente_id" required>
          {% for c in clienti %}
          <option value="{{ c.id_cliente }}" {% if e and e.cliente_id==c.id_cliente %}selected{% endif %}>
            {{ c.cognome }} {{ c.nome }} — {{ c.telefono }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="form__group">
        <label class="form__label">Evento</label>
        <select class="form__input" name="evento_id" required>
          {% for ev in eventi %}
          <option value="{{ ev.id_evento }}" {% if e and e.evento_id==ev.id_evento %}selected{% endif %}>
            {{ ev.data_evento }} — {{ ev.nome_evento }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form__group">
      <label class="form__label">Tipo</label>
      <select class="form__input" name="tipo" id="tipo" required>
        <option value="lista" {% if e and e.tipo=='lista' %}selected{% endif %}>Lista</option>
        <option value="tavolo" {% if e and e.tipo=='tavolo' %}selected{% endif %}>Tavolo</option>
        <option value="prevendita" {% if e and e.tipo=='prevendita' %}selected{% endif %}>Prevendita</option>
      </select>
    </div>

    <div class="form__group" id="grp_num_persone" style="display:none;">
      <label class="form__label">Numero persone (tavolo)</label>
      <input class="form__input" type="number" min="1" name="num_persone" id="num_persone" value="{{ e.num_persone if e else '' }}">
    </div>

    <div class="form__group" id="grp_note" style="display:none;">
      <label class="form__label">Note (obbligatorie per tavolo: nome tavolo)</label>
      <input class="form__input" name="note" id="note" value="{{ e.note if e else '' }}">
    </div>

    <div class="grid grid--2">
      <div class="form__group">
        <label class="form__label">Orario previsto (opz.)</label>
        <input class="form__input" name="orario_previsto" value="{{ e.orario_previsto if e else '' }}">
      </div>
      <div class="form__group">
        <label class="form__label">Stato</label>
        <select class="form__input" name="stato">
          <option value="attiva" {% if e and e.stato=='attiva' %}selected{% endif %}>Attiva</option>
          <option value="usata" {% if e and e.stato=='usata' %}selected{% endif %}>Usata</option>
          <option value="no-show" {% if e and e.stato=='no-show' %}selected{% endif %}>No-show</option>
          <option value="cancellata" {% if e and e.stato=='cancellata' %}selected{% endif %}>Cancellata</option>
        </select>
      </div>
    </div>

    <div class="form__actions">
      <button class="btn btn--primary">{{ 'Salva' if e else 'Crea' }}</button>
      <a class="btn btn--ghost" href="{{ url_for('prenotazioni.admin_list') }}">Annulla</a>
    </div>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script>
const tipo = document.getElementById('tipo');
const grpNum = document.getElementById('grp_num_persone');
const grpNote = document.getElementById('grp_note');
function toggleFields(){
  if (tipo.value === 'tavolo'){
    grpNum.style.display = '';
    grpNote.style.display = '';
  } else {
    grpNum.style.display = 'none';
    grpNote.style.display = 'none';
  }
}
if (tipo) { tipo.addEventListener('change', toggleFields); toggleFields(); }
</script>
{% endblock %}