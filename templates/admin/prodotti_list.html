{% extends "admin/base.html" %}
{% block admin_title %}Listino Prodotti{% endblock %}

{% block admin_content %}
<div class="products-hub">
  <header class="products-hub__header fade-in">
    <div class="products-hub__intro">
      <h1 class="products-hub__title">Listino Prodotti</h1>
      <p class="products-hub__subtitle">Gestisci disponibilità, prezzi e categorie per lo staff operativo.</p>
    </div>
    <div class="products-hub__actions">
      <form method="get" class="products-hub__filters">
        <label class="products-hub__filter-field">
          <span>Categoria</span>
          <input type="text" name="categoria" value="{{ filtro.categoria }}" placeholder="Es. Drink, Privé" class="form__input">
        </label>
        <label class="products-hub__filter-field">
          <span>Stato</span>
          <select name="attivo" class="form__select form__select--dense" onchange="this.form.submit()">
            <option value="" {% if not filtro.attivo %}selected{% endif %}>Tutti</option>
          <option value="si" {% if filtro.attivo=='si' %}selected{% endif %}>Attivi</option>
          <option value="no" {% if filtro.attivo=='no' %}selected{% endif %}>Disattivi</option>
        </select>
        </label>
      {% if filtro.categoria or filtro.attivo %}
        <a class="btn btn--ghost btn--small" href="{{ url_for('prodotti.admin_list') }}">Reset</a>
      {% endif %}
      </form>
      <a href="{{ url_for('prodotti.admin_new') }}" class="btn btn--primary btn--large">+ Nuovo prodotto</a>
    </div>
  </header>

  <section class="products-grid fade-in" style="animation-delay: 120ms;">
{% if prodotti %}
  {% for p in prodotti %}
      <article class="product-card">
        <div class="product-card__header">
          <div>
            <h2 class="product-card__title">{{ p.nome }}</h2>
            <div class="product-card__tags">
              <span class="badge badge--{{ 'success' if p.attivo else 'secondary' }}">{{ 'Attivo' if p.attivo else 'Disattivo' }}</span>
              {% if p.categoria %}<span class="badge badge--warning">{{ p.categoria }}</span>{% endif %}
            </div>
        </div>
          <div class="product-card__price">€{{ "%.2f"|format(p.prezzo) }}</div>
        </div>

        {% if p.descrizione %}
        <p class="product-card__description">{{ p.descrizione }}</p>
        {% endif %}

        <footer class="product-card__footer">
          <div class="product-card__actions">
        <a href="{{ url_for('prodotti.admin_edit', prodotto_id=p.id_prodotto) }}" class="btn btn--primary btn--small">Modifica</a>
            <form method="post" action="{{ url_for('prodotti.admin_delete', prodotto_id=p.id_prodotto) }}" onsubmit="return confirm('Eliminare questo prodotto?');">
              <button class="btn btn--ghost btn--small">Elimina</button>
        </form>
      </div>
          <small class="product-card__hint">Ricordati di aggiornare i prezzi quando pubblichi nuove promozioni.</small>
        </footer>
  </article>
  {% endfor %}
{% else %}
      <div class="empty-state">Il listino è vuoto. Aggiungi i primi prodotti per renderli disponibili allo staff.</div>
    {% endif %}
</section>
</div>
{% endblock %}

