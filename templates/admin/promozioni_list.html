{% extends "admin/base.html" %}
{% block admin_title %}Promozioni{% endblock %}

{% block admin_content %}
<div class="promo-hub">
  <header class="promo-hub__header fade-in">
    <div class="promo-hub__intro">
      <h1 class="promo-hub__title">Gestione Promozioni</h1>
      <p class="promo-hub__subtitle">Gestisci le promo attive e programmane di nuove per coinvolgere i clienti.</p>
  </div>
    <div class="promo-hub__actions">
      <form method="get" class="promo-hub__filter">
        <label class="promo-hub__filter-label">Stato</label>
        <select class="form__select form__select--dense" name="attiva" onchange="this.form.submit()">
          <option value="" {% if not filtro.attiva %}selected{% endif %}>Tutte</option>
        <option value="true" {% if filtro.attiva=='true' %}selected{% endif %}>Attive</option>
        <option value="false" {% if filtro.attiva=='false' %}selected{% endif %}>Disattive</option>
      </select>
      </form>
      <a href="{{ url_for('promozioni.admin_new') }}" class="btn btn--primary btn--large">+ Nuova Promozione</a>
    </div>
  </header>

  <section class="promo-grid fade-in" style="animation-delay: 120ms;">
    {% if promozioni %}
  {% for p in promozioni %}
    <article class="promo-card">
      <header class="promo-card__header">
      <div>
          <h2 class="promo-card__title">{{ p.nome }}</h2>
          <div class="promo-card__tags">
          <span class="badge badge--{{ 'success' if p.attiva else 'secondary' }}">{{ 'Attiva' if p.attiva else 'Disattiva' }}</span>
          <span class="badge badge--warning">{{ p.tipo|replace('_', ' ')|title }}</span>
            {% if p.auto_assegnazione %}<span class="badge">Auto-assegnazione</span>{% endif %}
          </div>
        </div>
        <a href="{{ url_for('promozioni.admin_promozione_detail', promozione_id=p.id_promozione) }}" class="btn btn--primary btn--small">Apri scheda</a>
      </header>

        {% if p.descrizione %}
      <p class="promo-card__description">{{ p.descrizione }}</p>
        {% endif %}

      <dl class="promo-card__meta">
          {% if p.valore %}
        <div>
          <dt>Valore</dt>
          <dd>
            {% if p.tipo == 'sconto_percentuale' %}
              {{ p.valore }}%
            {% else %}
              €{{ "%.2f"|format(p.valore) }}
            {% endif %}
          </dd>
        </div>
          {% endif %}
        <div>
          <dt>Periodo</dt>
          <dd>
            {{ p.data_inizio.strftime('%d/%m/%Y') if p.data_inizio else 'Inizio n/d' }} →
            {{ p.data_fine.strftime('%d/%m/%Y') if p.data_fine else 'Fine n/d' }}
          </dd>
        </div>
        <div>
          <dt>Requisiti</dt>
          <dd>
          {% if p.livello_richiesto %}
              Livello {{ p.livello_richiesto|upper }}
            {% else %}
              Nessun livello richiesto
          {% endif %}
            {% if p.punti_richiesti %} • {{ p.punti_richiesti }} pt{% endif %}
          </dd>
        </div>
      </dl>
  </article>
    {% endfor %}
  {% else %}
    <div class="empty-state">Non ci sono promozioni da mostrare. Crea la prima promozione per coinvolgere i clienti.</div>
    {% endif %}
  </section>
    </div>
{% endblock %}

