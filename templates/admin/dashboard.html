{% extends "admin/base.html" %}
{% block admin_title %}Dashboard Admin{% endblock %}

{% block admin_content %}
<div class="dashboard">
  <!-- Statistiche principali -->
  <div class="dashboard__stats">
    <div class="stat-card fade-in hover-elevate" style="animation-delay: 0ms;">
      <div class="stat-card__value">{{ tot_clienti }}</div>
      <div class="stat-card__label">Clienti Totali</div>
      <div class="stat-card__meta">{{ clienti_attivi }} attivi</div>
    </div>
    
    <div class="stat-card fade-in hover-elevate" style="animation-delay: 100ms;">
      <div class="stat-card__value">{{ tot_eventi }}</div>
      <div class="stat-card__label">Eventi Totali</div>
      <div class="stat-card__meta">{{ eventi_attivi }} attivi</div>
    </div>
    
    <div class="stat-card fade-in hover-elevate" style="animation-delay: 200ms;">
      <div class="stat-card__value">{{ ingressi_recenti }}</div>
      <div class="stat-card__label">Ingressi (30gg)</div>
    </div>
    
    <div class="stat-card fade-in hover-elevate" style="animation-delay: 300ms;">
      <div class="stat-card__value">€{{ "%.2f"|format(consumi_recenti) }}</div>
      <div class="stat-card__label">Consumi (30gg)</div>
    </div>
  </div>

  <!-- Prossimo evento -->
  {% if prossimo_evento %}
  <section class="card fade-in" style="animation-delay: 400ms;">
    <h2 class="card__title">Prossimo Evento</h2>
    <div class="evento-preview">
      <h3>{{ prossimo_evento.nome_evento }}</h3>
      <p class="card__meta">{{ prossimo_evento.data_evento }}</p>
      <p class="card__meta">{{ prossimo_evento.dj_artista or '—' }}</p>
      <div class="form__actions">
        <a href="{{ url_for('eventi.admin_edit', evento_id=prossimo_evento.id_evento) }}" class="btn btn--primary">Gestisci</a>
        <a href="{{ url_for('eventi.admin_analytics', evento_id=prossimo_evento.id_evento) }}" class="btn btn--secondary">Analytics</a>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- Grid con statistiche dettagliate -->
  <div class="grid grid--2">
    <!-- Distribuzione livelli -->
    <section class="card fade-in" style="animation-delay: 500ms;">
      <h2 class="card__title">Distribuzione Livelli</h2>
      <ul class="list">
        {% for livello, count in livelli_dist.items() %}
        <li class="list__item">
          <strong>{{ livello|capitalize }}</strong>: {{ count }} clienti
        </li>
        {% endfor %}
      </ul>
    </section>

    <!-- Media Feedback -->
    <section class="card fade-in" style="animation-delay: 600ms;">
      <h2 class="card__title">Media Feedback</h2>
      <ul class="list">
        <li class="list__item"><strong>Musica:</strong> {{ avg_musica }}/10</li>
        <li class="list__item"><strong>Ingresso:</strong> {{ avg_ingresso }}/10</li>
        <li class="list__item"><strong>Ambiente:</strong> {{ avg_ambiente }}/10</li>
      </ul>
    </section>
  </div>

  <!-- Top clienti -->
  <section class="card fade-in" style="animation-delay: 700ms;">
    <h2 class="card__title">Top 5 Clienti per Punti</h2>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Punti</th>
            <th>Livello</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          {% for cliente, punti in top_clienti %}
          <tr>
            <td>{{ cliente.nome }} {{ cliente.cognome }}</td>
            <td>{{ punti or 0 }}</td>
            <td>{{ cliente.livello|capitalize }}</td>
            <td>
              <a href="{{ url_for('clienti.admin_lista_clienti') }}#cliente-{{ cliente.id_cliente }}" class="btn btn--ghost btn--small">Vedi</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Eventi recenti -->
  <section class="card fade-in" style="animation-delay: 800ms;">
    <h2 class="card__title">Eventi Recenti</h2>
    <div class="list">
      {% for evento in eventi_recenti %}
      <article class="list__item">
        <div class="list__item-header">
          <strong>{{ evento.nome_evento }}</strong>
          <span class="badge badge--{{ 'success' if evento.stato == 'attivo' else 'secondary' }}">{{ evento.stato }}</span>
        </div>
        <div class="text--muted">{{ evento.data_evento }}</div>
        <div class="form__actions">
          <a href="{{ url_for('eventi.admin_edit', evento_id=evento.id_evento) }}" class="btn btn--secondary btn--small">Modifica</a>
          <a href="{{ url_for('eventi.admin_analytics', evento_id=evento.id_evento) }}" class="btn btn--ghost btn--small">Analytics</a>
        </div>
      </article>
      {% endfor %}
    </div>
  </section>

  <!-- Quick actions -->
  <section class="card fade-in" style="animation-delay: 900ms;">
    <h2 class="card__title">Azioni Rapide</h2>
    <div class="grid grid--3" style="margin-top: var(--spacing-lg);">
      <a href="{{ url_for('clienti.admin_lista_clienti') }}" class="btn btn--primary">Gestisci Clienti</a>
      <a href="{{ url_for('eventi.admin_menu') }}" class="btn btn--primary">Gestisci Eventi</a>
      <a href="{{ url_for('eventi.admin_new') }}" class="btn btn--primary">Nuovo Evento</a>
      <a href="{{ url_for('staff_admin.admin_new') }}" class="btn btn--primary">Nuovo Staff</a>
      <a href="{{ url_for('prenotazioni.admin_list') }}" class="btn btn--secondary">Prenotazioni</a>
      <a href="{{ url_for('ingressi.admin_list') }}" class="btn btn--secondary">Ingressi</a>
      <a href="{{ url_for('consumi.admin_list') }}" class="btn btn--secondary">Consumi</a>
      <a href="{{ url_for('fedelta.admin_list') }}" class="btn btn--secondary">Fedeltà</a>
      <a href="{{ url_for('promozioni.admin_list') }}" class="btn btn--secondary">Promozioni</a>
      <a href="{{ url_for('staff_admin.admin_list') }}" class="btn btn--secondary">Staff</a>
    </div>
  </section>
</div>
{% endblock %}

