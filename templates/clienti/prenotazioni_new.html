{% extends "clienti/base.html" %}
{% block title %}Nuova prenotazione{% endblock %}

{% block cliente_content %}
<section class="card">
  <h1 class="card__title">{{ e.nome_evento }}</h1>
  <div class="card__meta">{{ e.data_evento }} â€¢ {{ e.tipo_musica or e.categoria }}</div>

  <form class="form" method="post" action="{{ url_for('prenotazioni.nuova') }}">
    <input type="hidden" name="evento_id" value="{{ e.id_evento }}">

    <div class="form__group">
      <label class="form__label">Tipo prenotazione</label>
      <select class="form__input" name="tipo" id="tipo" required>
        {% for t in TIPI %}
        <option value="{{ t }}">{{ t|capitalize }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form__group" id="grp_num" style="display:none;">
      <label class="form__label">Numero persone (obbligatorio)</label>
      <input class="form__input" type="number" name="num_persone" id="num_persone" min="1" placeholder="Es: 6">
    </div>

    <div class="form__group" id="grp_note" style="display:none;">
      <label class="form__label">Nome tavolo (obbligatorio)</label>
      <input class="form__input" name="note" id="note" placeholder="Es: Tavolo VIP lato consolle">
    </div>

    <div class="form__actions">
      <button class="btn btn--primary" type="submit">Conferma</button>
      <a class="btn btn--ghost" href="{{ url_for('eventi.dettaglio_pubblico', evento_id=e.id_evento) }}">Annulla</a>
    </div>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script>
const tipo = document.getElementById('tipo');
const grpNote = document.getElementById('grp_note');
const note = document.getElementById('note');
const grpNum = document.getElementById('grp_num');
const num = document.getElementById('num_persone');

function toggleFields(){
  if (tipo.value === 'tavolo'){
    grpNote.style.display = '';
    note.setAttribute('required','required');
    grpNum.style.display = '';
    num.setAttribute('required','required');
  } else {
    grpNote.style.display = 'none';
    note.removeAttribute('required');
    grpNum.style.display = 'none';
    num.removeAttribute('required');
  }
}
tipo.addEventListener('change', toggleFields);
toggleFields();
</script>
{% endblock %}